sudo: required

env:
  matrix:
    - RESTY_REQL_PATH="lua-resty-reql/ubuntu/1.0.0"
    - RESTY_REQL_PATH="lua-resty-reql/alpine/1.0.0"

services:
  - docker

before_install:
  - docker build -t grandquista/lua-resty-reql $RESTY_REQL_PATH
  - docker run -d grandquista/lua-resty-reql --network host -P
  - docker cp t/ grandquista/lua-resty-reql:t
  - docker run -d -p 127.0.0.1:28015:28015 rethinkdb
  - docker ps -a

script:
  - docker exec -it grandquista/lua-resty-reql prove -r t
